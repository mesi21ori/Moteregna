(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[863],{14733:function(e,s,i){Promise.resolve().then(i.bind(i,38547))},38547:function(e,s,i){"use strict";i.r(s),i.d(s,{default:function(){return g}});var r=i(57437),t=i(2265),a=i(62869),c=i(66070),n=i(95186),l=i(73578),d=i(26110),o=i(26815),h=i(35974),p=i(73247),u=i(92369),x=i(15868),m=i(99376),j=i(14438);function g(){let e=(0,m.useRouter)(),[s,i]=(0,t.useState)(""),[g,f]=(0,t.useState)(!1),[y,N]=(0,t.useState)(null),[P,b]=(0,t.useState)(""),[v,w]=(0,t.useState)(""),[S,C]=(0,t.useState)([]),[k,E]=(0,t.useState)(!0),[B,Z]=(0,t.useState)({page:1,limit:10,total:0,totalPages:1});(0,t.useEffect)(()=>{z()},[B.page,s]);let z=async()=>{try{E(!0);let e=await fetch("/api/prices/history?page=".concat(B.page,"&limit=").concat(B.limit,"&search=").concat(s),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch pricing data");let{data:i,pagination:r}=await e.json();C(i),Z(r)}catch(s){console.error("Error fetching price history:",s),j.Am.error(s instanceof Error?s.message:"Failed to load pricing data"),s instanceof Error&&s.message.includes("Unauthorized")&&e.push("/signin")}finally{E(!1)}},F=e=>{Z(s=>({...s,page:e}))},K=e=>{N(e),b(e.basePrice.toString()),w(e.perKmPrice.toString()),f(!0)},A=async()=>{if(y)try{if("new"===y.id){if(!(await fetch("/api/prices/addnew",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({basePrice:Number(P),perKmPrice:Number(v)})})).ok)throw Error("Failed to create pricing");j.Am.success("Pricing created successfully")}else{if(!(await fetch("/api/prices/update?id=".concat(y.id),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({basePrice:Number(P),perKmPrice:Number(v)})})).ok)throw Error("Failed to update pricing");j.Am.success("Pricing updated successfully")}await z(),f(!1)}catch(e){j.Am.error(e instanceof Error?e.message:"Failed to update pricing")}},T=S.filter(e=>e.updatedBy.toLowerCase().includes(s.toLowerCase()));return k&&0===S.length?(0,r.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"Pricing History"}),(0,r.jsxs)("div",{className:"relative w-full sm:w-64",children:[(0,r.jsx)(p.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(n.I,{placeholder:"Search by updated by...",className:"pl-8",value:s,onChange:e=>{i(e.target.value),Z(e=>({...e,page:1}))}})]})]}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsx)(c.ll,{children:"Price List"}),(0,r.jsx)(c.SZ,{children:"View and update pricing history"})]}),(0,r.jsxs)(c.aY,{children:[(0,r.jsx)("div",{className:"rounded-md border overflow-hidden",children:(0,r.jsxs)(l.iA,{children:[(0,r.jsx)(l.xD,{children:(0,r.jsxs)(l.SC,{children:[(0,r.jsx)(l.ss,{children:"Base Price"}),(0,r.jsx)(l.ss,{children:"Per KM Price"}),(0,r.jsx)(l.ss,{children:"Created"}),(0,r.jsx)(l.ss,{children:"Last Updated"}),(0,r.jsx)(l.ss,{children:"Updated By"}),(0,r.jsx)(l.ss,{className:"text-right",children:"Actions"})]})}),(0,r.jsx)(l.RM,{children:T.length>0?T.map(e=>(0,r.jsxs)(l.SC,{children:[(0,r.jsxs)(l.pj,{children:[e.basePrice.toFixed(2)," ETB"]}),(0,r.jsxs)(l.pj,{children:["ETB ",e.perKmPrice.toFixed(2),"/km"]}),(0,r.jsx)(l.pj,{children:(0,r.jsx)(h.C,{variant:"outline",children:new Date(e.createdAt).toLocaleDateString()})}),(0,r.jsx)(l.pj,{children:(0,r.jsx)(h.C,{variant:"outline",children:new Date(e.updatedAt).toLocaleDateString()})}),(0,r.jsx)(l.pj,{children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(u.Z,{className:"mr-2 h-4 w-4 text-primary"}),e.updatedBy]})}),(0,r.jsx)(l.pj,{className:"text-right",children:(0,r.jsxs)(a.z,{variant:"ghost",size:"sm",onClick:()=>K(e),children:[(0,r.jsx)(x.Z,{className:"mr-2 h-4 w-4"}),"Edit"]})})]},e.id)):(0,r.jsx)(l.SC,{children:(0,r.jsx)(l.pj,{colSpan:6,className:"h-24 text-center",children:"No pricing data found."})})})]})}),B.totalPages>1&&(0,r.jsxs)("div",{className:"flex items-center justify-end space-x-2 pt-4",children:[(0,r.jsx)(a.z,{variant:"outline",size:"sm",onClick:()=>F(B.page-1),disabled:1===B.page,children:"Previous"}),(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",B.page," of ",B.totalPages]}),(0,r.jsx)(a.z,{variant:"outline",size:"sm",onClick:()=>F(B.page+1),disabled:B.page===B.totalPages,children:"Next"})]})]})]}),(0,r.jsx)(d.Vq,{open:g,onOpenChange:f,children:(0,r.jsxs)(d.cZ,{children:[(0,r.jsxs)(d.fK,{children:[(0,r.jsx)(d.$N,{children:"Update Pricing"}),(0,r.jsx)(d.Be,{children:"Set new base price and per kilometer rate"})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(o._,{htmlFor:"basePrice",children:"Base Price (ETB)"}),(0,r.jsx)(n.I,{id:"basePrice",type:"number",step:"0.01",min:"0",value:P,onChange:e=>b(e.target.value)})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(o._,{htmlFor:"perKmPrice",children:"Per KM Price (ETB)"}),(0,r.jsx)(n.I,{id:"perKmPrice",type:"number",step:"0.01",min:"0",value:v,onChange:e=>w(e.target.value)})]})]}),(0,r.jsxs)(d.cN,{children:[(0,r.jsx)(a.z,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),(0,r.jsx)(a.z,{onClick:A,children:"Save Changes"})]})]})})]})}},73247:function(e,s,i){"use strict";i.d(s,{Z:function(){return r}});let r=(0,i(79205).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},92369:function(e,s,i){"use strict";i.d(s,{Z:function(){return r}});let r=(0,i(79205).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])}},function(e){e.O(0,[181,793,799,347,587,971,117,744],function(){return e(e.s=14733)}),_N_E=e.O()}]);