"use strict";(()=>{var e={};e.id=5036,e.ids=[5036],e.modules={53524:e=>{e.exports=require("@prisma/client")},99344:e=>{e.exports=require("jsonwebtoken")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},56249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})},1234:(e,t,i)=>{i.r(t),i.d(t,{config:()=>v,default:()=>f,routeModule:()=>p});var n={};i.r(n),i.d(n,{default:()=>m});var s=i(71802),r=i(47153),a=i(56249),o=i(53524),l=i(99344),u=i.n(l);let d=new o.PrismaClient,c=e=>{try{return u().verify(e,process.env.JWT_SECRET_KEY)}catch(e){return null}};async function m(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let i=e.headers.authorization?.split(" ")[1]||e.cookies.session_token;if(!i)return t.status(401).json({message:"Unauthorized"});let n=c(i);if(!n)return t.status(403).json({message:"Forbidden"});if(!["ADMIN","SUPERADMIN"].includes(n.role))return t.status(403).json({message:"Forbidden: Insufficient privileges"});let s=Number(e.query.page)||1,r=Number(e.query.limit)||10,a=(s-1)*r,o=e.query.search||"",l=e.query.status||void 0,u=e.query.vehicleType||void 0,m=e.query.sortField||"createdAt",f=e.query.sortOrder||"desc",v={AND:[{OR:[{user:{firstName:{contains:o,mode:"insensitive"}}},{user:{lastName:{contains:o,mode:"insensitive"}}},{licenseNumber:{contains:o,mode:"insensitive"}},{vehiclePlateNumber:{contains:o,mode:"insensitive"}}]},...l?[{isAvailable:"available"===l}]:[],...u?[{vehicleModel:{contains:u,mode:"insensitive"}}]:[]]},p=await d.motorist.count({where:v}),P=(await d.motorist.findMany({skip:a,take:r,where:v,orderBy:{[m]:f},include:{user:!0,deliveries:{select:{distance:!0,status:!0}}}})).map(e=>{let t=e.deliveries.length,i=e.deliveries.reduce((e,t)=>e+(t.distance||0),0);return{id:e.id,name:`${e.user.firstName} ${e.user.lastName}`,phone:e.user.phone,licenseNumber:e.licenseNumber,vehicle:`${e.vehicleModel} (${e.vehiclePlateNumber})`,status:e.isAvailable?"Available":"Unavailable",onlineStatus:e.isOnline?"Online":"Offline",totalDeliveries:t,totalDistance:`${i.toFixed(2)} km`,joinedDate:e.createdAt.toISOString().split("T")[0]}});t.status(200).json({success:!0,data:P,pagination:{total:p,page:s,limit:r,totalPages:Math.ceil(p/r)}})}catch(e){console.error("Error:",e),t.status(500).json({success:!1,message:"Internal server error"})}finally{await d.$disconnect()}}let f=(0,a.l)(n,"default"),v=(0,a.l)(n,"config"),p=new s.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/admin/list_of_motorist",pathname:"/api/admin/list_of_motorist",bundlePath:"",filename:""},userland:n})},47153:(e,t)=>{var i;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))},71802:(e,t,i)=>{e.exports=i(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var i=t(t.s=1234);module.exports=i})();