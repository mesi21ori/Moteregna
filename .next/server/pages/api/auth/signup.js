"use strict";(()=>{var e={};e.id=7011,e.ids=[7011],e.modules={53524:e=>{e.exports=require("@prisma/client")},67096:e=>{e.exports=require("bcrypt")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9926:e=>{e.exports=import("zod")},56249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,i){return i in r?r[i]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,i)):"function"==typeof r&&"default"===i?r:void 0}}})},94420:(e,r,i)=>{i.a(e,async(e,t)=>{try{i.r(r),i.d(r,{config:()=>d,default:()=>u,routeModule:()=>m});var n=i(71802),s=i(47153),a=i(56249),o=i(89329),l=e([o]);o=(l.then?(await l)():l)[0];let u=(0,a.l)(o,"default"),d=(0,a.l)(o,"config"),m=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/auth/signup",pathname:"/api/auth/signup",bundlePath:"",filename:""},userland:o});t()}catch(e){t(e)}})},89329:(e,r,i)=>{i.a(e,async(e,t)=>{try{i.r(r),i.d(r,{config:()=>p,default:()=>d});var n=i(53524),s=i(67096),a=i.n(s),o=i(34816),l=i(9926),u=e([l]);l=(u.then?(await u)():u)[0];let m=new n.PrismaClient,c=l.z.object({firstName:l.z.string().min(1,"First name is required"),middleName:l.z.string().optional(),lastName:l.z.string().min(1,"Last name is required"),phone:l.z.string().min(1,"Phone number is required"),password:l.z.string().min(6,"Password must be at least 6 characters long"),gender:l.z.string().optional(),birthdate:l.z.string().optional(),address:l.z.string().optional(),licenseNumber:l.z.string().min(1,"License number is required"),vehicleModel:l.z.string().min(1,"Vehicle model is required"),vehiclePlateNumber:l.z.string().min(1,"Vehicle plate number is required")}),p={api:{bodyParser:!1}};async function d(e,r){if("POST"!==e.method)return r.status(405).json({message:"Method not allowed"});(0,o.Z)(e,r,async i=>{if(i)return r.status(400).json({message:"File upload error",error:i});try{let i=c.parse(e.body);if(await m.user.findUnique({where:{phone:i.phone}}))return r.status(400).json({message:"Phone number already registered"});if(await m.motorist.findUnique({where:{licenseNumber:i.licenseNumber}}))return r.status(400).json({message:"License number already registered"});let t=await a().hash(i.password,10),n={librePhoto:e.files?.Librephoto?.[0]?.filename?`/uploads/${e.files.Librephoto[0].filename}`:null,driversLicenseFront:e.files?.driversLicencephotoFront?.[0]?.filename?`/uploads/${e.files.driversLicencephotoFront[0].filename}`:null,profilePhoto:e.files?.profile?.[0]?.filename?`/uploads/${e.files.profile[0].filename}`:null,businessPermit:e.files?.businessPermit?.[0]?.filename?`/uploads/${e.files.businessPermit[0].filename}`:null},s=await m.user.create({data:{firstName:i.firstName,middleName:i.middleName,lastName:i.lastName,phone:i.phone,password:t,gender:i.gender,birthdate:i.birthdate?new Date(i.birthdate):null,address:i.address,profile:n.profilePhoto,role:"MOTORIST"}}),o=await m.motorist.create({data:{userId:s.id,licenseNumber:i.licenseNumber,vehicleModel:i.vehicleModel,vehiclePlateNumber:i.vehiclePlateNumber,Librephoto:n.librePhoto||"",driversLicencephotoFront:n.driversLicenseFront||"",businessPermit:n.businessPermit||""}});return await m.motorist.update({where:{id:o.id},data:{userId:s.id}}),r.status(201).json({message:"Motorist registered successfully",user:{id:s.id,phone:s.phone,role:s.role},motorist:{id:o.id,licenseNumber:o.licenseNumber}})}catch(e){if(console.error("Error during motorist registration:",e),e instanceof l.z.ZodError)return r.status(400).json({message:"Validation failed",errors:e.errors});return r.status(500).json({message:"Internal server error",error:e instanceof Error?e.message:"Unknown error"})}})}t()}catch(e){t(e)}})},34816:(e,r,i)=>{i.d(r,{Z:()=>l});let t=require("multer");var n=i.n(t);let s=require("path");var a=i.n(s);let o=n().diskStorage({destination:function(e,r,i){i(null,"./public/uploads/")},filename:function(e,r,i){i(null,Date.now()+a().extname(r.originalname))}}),l=n()({storage:o}).fields([{name:"Librephoto",maxCount:1},{name:"driversLicencephotoFront",maxCount:1},{name:"profile",maxCount:1},{name:"businessPermit",maxCount:1}])},47153:(e,r)=>{var i;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))},71802:(e,r,i)=>{e.exports=i(20145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var i=r(r.s=94420);module.exports=i})();