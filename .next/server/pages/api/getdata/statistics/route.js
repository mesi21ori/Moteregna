"use strict";(()=>{var e={};e.id=6945,e.ids=[6945],e.modules={53524:e=>{e.exports=require("@prisma/client")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92824:e=>{e.exports=require("next/server")},9926:e=>{e.exports=import("zod")},56249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},805:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>u,routeModule:()=>d});var s=r(71802),n=r(47153),i=r(56249),o=r(74656),c=e([o]);o=(c.then?(await c)():c)[0];let u=(0,i.l)(o,"default"),l=(0,i.l)(o,"config"),d=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/getdata/statistics/route",pathname:"/api/getdata/statistics/route",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},74656:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{GET:()=>c});var s=r(53524),n=r(92824),i=r(9926),o=e([i]);i=(o.then?(await o)():o)[0];let u=new s.PrismaClient,l=i.z.object({range:i.z.enum(["30days","3months","6months","1year"])});async function c(e){try{let t;let r=new URL(e.url).searchParams.get("range");if(!r)return n.NextResponse.json({success:!1,message:"Bad request: Missing range parameter"},{status:400});try{l.parse({range:r})}catch(e){if(e instanceof i.z.ZodError)return n.NextResponse.json({success:!1,message:"Validation failed",errors:e.errors},{status:400})}let a=new Date;switch(r){case"30days":t=new Date(a.getTime()-2592e6);break;case"3months":t=new Date(a.getTime()-7776e6);break;case"6months":default:t=new Date(a.getTime()-15552e6);break;case"1year":t=new Date(a.getTime()-31536e6)}let[s,o]=await Promise.all([u.motorist.findMany({where:{createdAt:{gte:t}},select:{id:!0,createdAt:!0,isOnline:!0}}),u.motorist.groupBy({by:["createdAt"],where:{createdAt:{gte:t}},_count:{_all:!0}})]),c=o.reduce((e,t)=>{let r=new Date(t.createdAt).toLocaleString("default",{month:"short"});return e[r]={month:r,active:0,new:t._count._all,inactive:0},e},{});return s.forEach(e=>{let t=new Date(e.createdAt).toLocaleString("default",{month:"short"});c[t]&&e.isOnline&&c[t].active++}),Object.values(c).forEach(e=>{e.inactive=e.new-e.active}),n.NextResponse.json({success:!0,data:Object.values(c)})}catch(e){if(console.error("Error in statistics API:",e),e instanceof i.z.ZodError)return n.NextResponse.json({success:!1,message:"Validation failed",errors:e.errors},{status:400});return n.NextResponse.json({success:!1,message:"Internal server error",error:void 0},{status:500})}finally{await u.$disconnect()}}a()}catch(e){a(e)}})},47153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=805);module.exports=r})();